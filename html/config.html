<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Configurações</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
 <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="/config.css"/>

</head>
<body>
<!-- partial:index.partial.html -->
<div class="settings-page">
  <div class="settings-container">
    <h1 class="page-title">Conta</h1>
    <div class="settings-section">
      <h2 class="settings-title">Meu Perfil</h2>
      <form class="form my-form" id="imageUploadForm" enctype="multipart/form-data" action="/upload" method="POST">
        <div class="img-upload-container">
          <label class="img-upload btn btn-bwm" id="imageLabel" for="profileImage">
            <div class="img-preview-container">
              <div class="img-preview" id="imgPreview">
                <img src="default-profile.png" alt="Preview" id="imagePreviewElement"> <!-- Coloque uma imagem padrão -->
              </div>
            </div>
            <i class="fas fa-upload"></i> Escolher Imagem
          </label>
          <input type="file" accept=".jpg, .png, .jpeg, .gif" name="profileImage" id="profileImage" style= "display: none;">
          <h4 id="changeProfileText">Altere sua foto de perfil</h4> <!-- Adicionado id -->
        </div>
        <div class="form-submit">
          <button class="btn button full" type="submit">Salve sua foto</button>
        </div>
        <!-- Balão de confirmação -->
        <div id="confirmationBalloon" style="display: none; margin-top: 10px; padding: 10px; background-color: #4CAF50; color: white; border-radius: 5px;">
          Foto de perfil atualizada com sucesso!
        </div>
      </form>
    </div>
    <div class="settings-section">
      <h2 class="settings-title">informações Gerais</h2>
   <div>
     <div class="non-active-form">
       <p class="capitalize">Rodrigo</p><i class="fas fa-pen"></i>
     </div>
    </div>
    <div>
      <div class="non-active-form">
        <p>rodrigoconcei190@gmail.com</p>
      </div>
    </div>
  </div>

<div class="settings-section">
  <h2 class="settings-title">Senha</h2>
  <form class="form my-form">
    <div class="form-group">
      <div class="input-group">
        <input name="currentPassword" placeholder="Senha Anterior" type="password" class="form-control" autocomplete="Old Password" value="">
        <span class="focus-input"></span>
      </div>
    </div>
    <div class="form-group">
      <div class="input-group">
        <input name="password" placeholder="Senha Nova" type="password" class="form-control" autocomplete="New Password" value="">
        <span class="focus-input"></span>
      </div>
    </div>
   <div class="form-submit right">
     <button class="btn button full" type="submit" disabled="">Alterar Senha</button>
    </div>
  </form>
</div>
</div>
</div>
<!-- partial -->
<script>
  const inputElement = document.getElementById('profileImage');
  const previewElement = document.getElementById('imagePreviewElement');
  const changeProfileText = document.getElementById('changeProfileText'); // Referência ao texto
  const imageUploadForm = document.getElementById('imageUploadForm');
  const confirmationBalloon = document.getElementById('confirmationBalloon');

  // Preview da imagem no navegador
  inputElement.addEventListener('change', function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
      previewElement.src = e.target.result;
    };

    if (file) {
      reader.readAsDataURL(file);
    }
  });

  // Simular clique no input ao clicar no texto "Altere sua foto de perfil"
  changeProfileText.addEventListener('click', function() {
    inputElement.click();
  });

  // Enviar o formulário via AJAX e mostrar o balão de confirmação
  imageUploadForm.addEventListener('submit', function(event) {
    event.preventDefault(); // Evitar o envio padrão do formulário

    const formData = new FormData(imageUploadForm);

    fetch('/upload', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Mostrar o balão de confirmação
        confirmationBalloon.style.display = 'block';
        // Ocultar o balão após 3 segundos
        setTimeout(() => {
          confirmationBalloon.style.display = 'none';
        }, 3000);
      } else {
        alert('Ocorreu um erro ao salvar a imagem.');
      }
    })
    .catch(error => {
      alert('Erro ao tentar enviar a imagem.');
      console.error('Erro:', error);
    });
  });

  // Carregar a imagem do perfil quando a página carregar
  window.onload = function() {
    fetch('/user/profile-image')
      .then(response => {
        if (!response.ok) {
          throw new Error('Erro na autenticação ou na requisição de imagem.');
        }
        return response.json();
      })
      .then(data => {
        if (data.imageUrl) {
          previewElement.src = `${data.imageUrl}?t=${new Date().getTime()}`;
        }
      })
      .catch(error => {
        console.error('Erro ao carregar a imagem do usuário:', error);
      });
  };
  
</script> 
</body>
</html>
